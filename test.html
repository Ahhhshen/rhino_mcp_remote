<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rhino WebSocket test page</title>
    <style>
      body {
        padding: 20px;
        font-family: Arial, sans-serif;
      }
      #output {
        background: #f0f0f0;
        padding: 10px;
        margin-top: 10px;
        min-height: 200px;
      }
      button {
        padding: 10px 20px;
        background: #4caf50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background: #45a049;
      }
    </style>
  </head>
  <body>
    <h1>Rhino WebSocket test page</h1>
    <button onclick="createCube()">create cube</button>
    <button onclick="getScene()">get scene info</button>
    <div>status: <span id="status">not connected</span></div>
    <pre id="output"></pre>

    <script>
      let ws = null;
      const output = document.getElementById("output");
      const status = document.getElementById("status");

      // connect WebSocket
      function connect() {
        ws = new WebSocket("ws://localhost:8000/rhino/ws");

        ws.onopen = () => {
          status.textContent = "connected";
          status.style.color = "green";
          log("WebSocket connection successful");
        };

        ws.onmessage = (event) => {
          log("received message: " + event.data);
        };

        ws.onclose = () => {
          status.textContent = "disconnected";
          status.style.color = "red";
          log("WebSocket connection closed");
          // reconnect after 5 seconds
          setTimeout(connect, 5000);
        };

        ws.onerror = (error) => {
          log("error: " + error.message);
        };
      }

      // create cube
      function createCube() {
        if (!ws || ws.readyState !== WebSocket.OPEN) {
          log("WebSocket not connected!");
          return;
        }

        const command = {
          type: "create_cube",
          params: { size: 10 },
        };
        ws.send(JSON.stringify(command));
        log("send command: create cube");
      }

      // get scene info
      function getScene() {
        if (!ws || ws.readyState !== WebSocket.OPEN) {
          log("WebSocket not connected!");
          return;
        }

        const command = {
          type: "get_rhino_scene_info",
        };
        ws.send(JSON.stringify(command));
        log("send command: get scene info");
      }

      // log
      function log(message) {
        const time = new Date().toLocaleTimeString();
        output.textContent = `[${time}] ${message}\n` + output.textContent;
      }

      // start connection
      connect();
    </script>
  </body>
</html>
